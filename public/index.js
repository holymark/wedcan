var database = [
  {
    "name": "OREOLUWA OLORUNMAYE (CHIEF BRIDESMAID)",
    "seatNumber": "0"
  },
  {
    "name": "OREOLUWA OLORUNMAYE (CHIEF BRIDESMAID)",
    "seatNumber": "2"
  },
  {
    "name": "OREOLUWA OLORUNMAYE (CHIEF BRIDESMAID)",
    "seatNumber": "2"
  },
  {
    "name": "OREOLUWA OLORUNMAYE (CHIEF BRIDESMAID)",
    "seatNumber": "2"
  },
  {
    "name": "OREOLUWA OLORUNMAYE (CHIEF BRIDESMAID)",
    "seatNumber": "2"
  },
  {
    "name": "OREOLUWA OLORUNMAYE (CHIEF BRIDESMAID)",
    "seatNumber": "2"
  },
  {
    "name": "MRS FOLORUNSHO",
    "seatNumber": "2"
  },
  {
    "name": "MRS AGNES EGURE",
    "seatNumber": "2"
  },
  {
    "name": "ILLIASU MUBARAK",
    "seatNumber": "2"
  },
  {
    "name": "DR. (MRS.) ELIZABETH ELHASSAN",
    "seatNumber": "3"
  },
  {
    "name": "MRS ANITA GWOM",
    "seatNumber": "3"
  },
  {
    "name": "BARR. KABIRU",
    "seatNumber": "3"
  },
  {
    "name": "MR ROGERS NWOKE",
    "seatNumber": "3"
  },
  {
    "name": "HONOURABLE PETER",
    "seatNumber": "3"
  },
  {
    "name": "HONOURABLE ISHAQ",
    "seatNumber": "3"
  },
  {
    "name": "MR GOKE",
    "seatNumber": "3"
  },
  {
    "name": "MR GBEMIGA",
    "seatNumber": "3"
  },
  {
    "name": "MRS ELIZABETH",
    "seatNumber": "3"
  },
  {
    "name": "MR GBENGA ILORI",
    "seatNumber": "4"
  },
  {
    "name": "MRS GRACE ILLORI",
    "seatNumber": "4"
  },
  {
    "name": "MR ISHAKU UMAR",
    "seatNumber": "4"
  },
  {
    "name": "MRS CHRISTIAN",
    "seatNumber": "3"
  },
  {
    "name": "AWWAL SALISU",
    "seatNumber": "4"
  },
  {
    "name": "SANI AMIRU",
    "seatNumber": "4"
  },
  {
    "name": "MRS DEBORAH AYINLA",
    "seatNumber": "4"
  },
  {
    "name": "PRECIOUS UNILAG",
    "seatNumber": "4"
  },
  {
    "name": "MR SHERIFF",
    "seatNumber": "4"
  },
  {
    "name": "MRS SHERIFF",
    "seatNumber": "4"
  },
  {
    "name": "AUSTIN GEMSTONE",
    "seatNumber": "4"
  },
  {
    "name": "MR. DANJUMA",
    "seatNumber": "4"
  },
  {
    "name": "MR. SUNDAY",
    "seatNumber": "4"
  },
  {
    "name": "MAIMUNATU GUEST 1",
    "seatNumber": "2"
  },
  {
    "name": "MAIMUNATU GUEST 2",
    "seatNumber": "2"
  },
  {
    "name": "AUDU FAITH (BRIDE'S MAID/PHOTOGRAPHER)",
    "seatNumber": "5"
  },
  {
    "name": "SALAMATU YAHAYA (BRIDE'S MAID)",
    "seatNumber": "5"
  },
  {
    "name": "FRANCISCA OPARA (BRIDE'S MAID/MAKEUP ARTIST)",
    "seatNumber": "5"
  },
  {
    "name": "YAKUBU PRECIOUS (BRIDE'S MAID)",
    "seatNumber": "5"
  },
  {
    "name": "SUZIE NAMAS (BRIDE'S MAID)",
    "seatNumber": "5"
  },
  {
    "name": "BAKO FATIMA (BRIDE'S MAID)",
    "seatNumber": "5"
  },
  {
    "name": "RHODA AREH (BRIDE'S MAID)",
    "seatNumber": "5"
  },
  {
    "name": "REJOICE EDOM (BRIDE'S MAID)",
    "seatNumber": "5"
  },
  {
    "name": "FUNMI OYENIYI (BRIDE'S MAID)",
    "seatNumber": "5"
  },
  {
    "name": "MAIMUNATU DAMISA",
    "seatNumber": "9"
  },
  {
    "name": "SUNDAY DAMISA",
    "seatNumber": "9"
  },
  {
    "name": "KABIRU DAMISA",
    "seatNumber": "9"
  },
  {
    "name": "GANIU DAMISA",
    "seatNumber": "9"
  },
  {
    "name": "JANET DAMISA",
    "seatNumber": "5"
  },
  {
    "name": "DANIEL DAMISA",
    "seatNumber": "9"
  },
  {
    "name": "ABDUL DAMISA",
    "seatNumber": "9"
  },
  {
    "name": "SAFIYA ANTHONY",
    "seatNumber": "9"
  },
  {
    "name": "RUFAI OZIGI",
    "seatNumber": "9"
  },
  {
    "name": "JOHN OZIGI",
    "seatNumber": "9"
  },
  {
    "name": "BLESSING OHA",
    "seatNumber": "9"
  },
  {
    "name": "MR. ANTHONY",
    "seatNumber": "9"
  },
  {
    "name": "NDUBISI CHIJIOKE",
    "seatNumber": "10"
  },
  {
    "name": "DAMILOLA INAWOLE",
    "seatNumber": "10"
  },
  {
    "name": "TOSIN MICHEAL",
    "seatNumber": "10"
  },
  {
    "name": "BRIDGET",
    "seatNumber": "10"
  },
  {
    "name": "SEUN MAYE",
    "seatNumber": "10"
  },
  {
    "name": "BISOLA",
    "seatNumber": "10"
  },
  {
    "name": "MR. ISRAEL ONOJA",
    "seatNumber": "10"
  },
  {
    "name": "ILERIOLUWA OLORUNMAYE",
    "seatNumber": "10"
  },
  {
    "name": "CHARLES EZENGWA",
    "seatNumber": "10"
  },
  {
    "name": "TAKU AZIMAZI",
    "seatNumber": "10"
  },
  {
    "name": "ISREAL ADEOLA",
    "seatNumber": "8"
  },
  {
    "name": "MR BLINKS OCHECHE",
    "seatNumber": "11"
  },
  {
    "name": "MR GODWIN OCHECHE",
    "seatNumber": "11"
  },
  {
    "name": "JONATHAN OJEKA",
    "seatNumber": "11"
  },
  {
    "name": "FAITH EGURE",
    "seatNumber": "11"
  },
  {
    "name": "BLESSING EGURE",
    "seatNumber": "11"
  },
  {
    "name": "RUTH BELLO",
    "seatNumber": "11"
  },
  {
    "name": "FRIEND TO THE BRIDE 1",
    "seatNumber": "11"
  },
  {
    "name": "FRIEND TO THE BRIDE 2",
    "seatNumber": "11"
  },
  {
    "name": "FRIEND TO THE BRIDE 3",
    "seatNumber": "11"
  },
  {
    "name": "FRIEND TO THE BRIDE 4",
    "seatNumber": "11"
  },
  {
    "name": "IKO RICHARD",
    "seatNumber": "11"
  },
  {
    "name": "JUNIOR",
    "seatNumber": "13"
  },
  {
    "name": "ISAAC",
    "seatNumber": "13"
  },
  {
    "name": "BRO OSCAR",
    "seatNumber": "13"
  },
  {
    "name": "SIS PERPETUAL",
    "seatNumber": "13"
  },
  {
    "name": "CHRISTIANA FOLORUNSHO",
    "seatNumber": "13"
  },
  {
    "name": "MR. DEENY",
    "seatNumber": "13"
  },
  {
    "name": "MRS DORCAS ISABELLA",
    "seatNumber": "13"
  },
  {
    "name": "SOFIA",
    "seatNumber": "13"
  },
  {
    "name": "FRIEND TO THE BRIDE 5",
    "seatNumber": "15"
  },
  {
    "name": "FRIEND TO THE BRIDE 6",
    "seatNumber": "15"
  },
  {
    "name": "MICHEAL LAMAI",
    "seatNumber": "13"
  },
  {
    "name": "MR & MRS. MOSES AKINTOYE",
    "seatNumber": "1"
  },
  {
    "name": "MR & MRS. ADEOLA JOHN",
    "seatNumber": "1"
  },
  {
    "name": "MR. KHEINDE OLORUNSHOLA",
    "seatNumber": "1"
  },
  {
    "name": "DANIEL AKINTOYE",
    "seatNumber": "7"
  },
  {
    "name": "SAMUEL AKINTOYE",
    "seatNumber": "6"
  },
  {
    "name": "GRACE AKINTOYE",
    "seatNumber": "8"
  },
  {
    "name": "EMMANUEL AGBO",
    "seatNumber": "8"
  },
  {
    "name": "GABRIEL ADELEKE",
    "seatNumber": "6"
  },
  {
    "name": "BABA T",
    "seatNumber": "7"
  },
  {
    "name": "HIGH CHIEF & MRS. NOSAKHARE OGHUMU",
    "seatNumber": "7"
  },
  {
    "name": "JOEL ANGO",
    "seatNumber": "0"
  },
  {
    "name": "STANLEY",
    "seatNumber": "6"
  },
  {
    "name": "YARIOK ELIAS",
    "seatNumber": "6"
  },
  {
    "name": "ABMAX",
    "seatNumber": "14"
  },
  {
    "name": "HERISON",
    "seatNumber": "14"
  },
  {
    "name": "ISHAKU SOLOMON",
    "seatNumber": "7"
  },
  {
    "name": "LEVI AKOMA",
    "seatNumber": "7"
  },
  {
    "name": "LEGACY",
    "seatNumber": "12"
  },
  {
    "name": "NIFTY",
    "seatNumber": "7"
  },
  {
    "name": "SYAKASAI",
    "seatNumber": "14"
  },
  {
    "name": "UTHMAN YD",
    "seatNumber": "14"
  },
  {
    "name": "NOAH",
    "seatNumber": "6"
  },
  {
    "name": "AUSTIN KIRAH",
    "seatNumber": "6"
  },
  {
    "name": "JERRY STEPHEN",
    "seatNumber": "6"
  },
  {
    "name": "BIGGY KHALI",
    "seatNumber": "6"
  },
  {
    "name": "ESOSA",
    "seatNumber": "12"
  },
  {
    "name": "SMOOTH",
    "seatNumber": "12"
  },
  {
    "name": "UNIMKE",
    "seatNumber": "12"
  },
  {
    "name": "ANGELA",
    "seatNumber": "12"
  },
  {
    "name": "ZION ADEBISI",
    "seatNumber": "12"
  },
  {
    "name": "SPELLSMEDIA",
    "seatNumber": "12"
  },
  {
    "name": "MCKAYLA OCHICKE",
    "seatNumber": "12"
  },
  {
    "name": "FAYYAZ",
    "seatNumber": "6"
  },
  {
    "name": "OLVERKAHN",
    "seatNumber": "6"
  },
  {
    "name": "SAMMUEL OMOH",
    "seatNumber": "7"
  },
  {
    "name": "ADAMS OGUCHE",
    "seatNumber": "8"
  },
  {
    "name": "SLIM",
    "seatNumber": "14"
  },
  {
    "name": "HOLY",
    "seatNumber": "14"
  },
  {
    "name": "SLY",
    "seatNumber": "14"
  },
  {
    "name": "JEMILA YHAHYA",
    "seatNumber": "14"
  },
  {
    "name": "DAMRIS ELISHA",
    "seatNumber": "14"
  },
  {
    "name": "MR. & MRS. MARK DOMNIC",
    "seatNumber": "8"
  },
  {
    "name": "CHIEF EZEGE",
    "seatNumber": "7"
  },
  {
    "name": "VIVIAN JOHN",
    "seatNumber": "12"
  },
  {
    "name": "HANNAH SUNDAY",
    "seatNumber": "8"
  },
  {
    "name": "VICTOR",
    "seatNumber": "8"
  },
  {
    "name": "ADAMU AHIJAH AMULO",
    "seatNumber": "8"
  },
  {
    "name": "DJ MUBBY",
    "seatNumber": "0"
  },
  {
    "name": "MC PRINZ TALKER",
    "seatNumber": "0"
  },
  {
    "name": "GROOM GUEST 1",
    "seatNumber": "14"
  },
  {
    "name": "GROOM GUEST 2",
    "seatNumber": "15"
  },
  {
    "name": "GROOM GUEST 3",
    "seatNumber": "15"
  },
  {
    "name": "GROOM GUEST 4",
    "seatNumber": "15"
  },
  {
    "name": "GROOM GUEST 5",
    "seatNumber": "15"
  },
  {
    "name": "GROOM PARENT GUEST 1",
    "seatNumber": "15"
  },
  {
    "name": "GROOM PARENT GUEST 2",
    "seatNumber": "15"
  },
  {
    "name": "GROOM PARENT GUEST 3",
    "seatNumber": "15"
  },
  {
    "name": "GROOM PARENT GUEST 4",
    "seatNumber": "8"
  },
  {
    "name": "GROOM PARENT GUEST 5",
    "seatNumber": "8"
  },
  {
    "name": "MR. & MRS. COKER",
    "seatNumber": "1"
  },
  {
    "name": "ALH. TOYIN JIMOH",
    "seatNumber": "1"
  },
  {
    "name": "MR. & MRS. TOLA ELIJAH",
    "seatNumber": "1"
  },
 
]
function findSeatNumberByName(nameToSearch) {
  const matchingEntry = database.find(entry => Object.values(entry).includes(nameToSearch));
  return matchingEntry ? matchingEntry.seatNumber : undefined;
}

function onScanSuccess(decodedText) {
  const seatNumber = findSeatNumberByName(decodedText);

  Swal.fire({
    title: "AUTHORIZED",
    html: `<p>Name: ${decodedText}<br/>Seat Number: ${seatNumber}</p><button>Check In?</button>`,
    icon: "success",
    confirmButtonText: "Save",
  }).then((result) => {
    if (result.isConfirmed) {

      try {
        saveScanned(decodedText, seatNumber)
        Swal.fire("Saved!", "", "success");
      } catch (e) {
        Swal.fire("Unable to save!", "", "error");

      }
    } else if (result.isDenied) {
      Swal.fire("Changes are not saved", "", "info");
    }
  });

  console.log(`Code matched = ${decodedText},\n seat Number is: ${seatNumber}`);
}

function onScanFailure(error) {
  console.warn(`Code scan error = ${error}`);
}

function startScan() {
  alert("hello world");
}

const html5QrcodeScanner = new Html5QrcodeScanner(
  "reader",
  { fps: 10, qrbox: { width: 300, height: 300 } },
  false
);
html5QrcodeScanner.render(onScanSuccess, onScanFailure);


async function saveScanned(name, seatNumber) {
  await fetch("https://3000-holymark-wedcan-n1twsqj9jr9.ws-eu107.gitpod.io/api/data",
    {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      body: { name, seatNumber, scanned: true }
    }).then(response => response.json())
    .then(data => {
      console.log('Data added successfully:', data);
    })
    .catch(error => console.error('Error adding data:', error));

}
async function getScanned(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }

    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error fetching data:', error.message);
    throw error; // Re-throw the error to handle it further if needed
  }
}

function formatMongoDBTimestamp(timestamp, includeDate = false) {
  const date = new Date(timestamp);

  const hours = date.getHours().toString().padStart(2, '0');
  const minutes = date.getMinutes().toString().padStart(2, '0');
  const seconds = date.getSeconds().toString().padStart(2, '0');

  if (includeDate) {
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
  } else {
    return `${hours}:${minutes}:${seconds}`;
  }
}

function removeScanned(button) {
  // Get the parent <li> element
  const listItem = button.parentNode;

  // Remove the <li> element
  listItem.parentNode.removeChild(listItem);
}

getScanned("https://3000-holymark-wedcan-n1twsqj9jr9.ws-eu107.gitpod.io/api/data")
  .then(d => {
    var html = ``
    html += `<ol class="list-decimal">`;
    d.forEach(d => {
      if (d && d.scanned == true) {
        html += `<li class="mb-4 border-l-4 border-blue-500 pl-4 py-2 pr-[134px] bg-blue-100 rounded-md relative">${d.name} (${d.seatNumber}), ${formatMongoDBTimestamp(d.updatedAt)}
        <button class="absolute top-0 right-0 p-2 text-white bg-red-500 hover:bg-red-700" onclick="removeScanned(this)">Remove</button>
      </li>`
        html += `<ol>`;
      }
    })
    document.getElementById("list-ps-in").innerHTML = html
  }
  ).catch(e => {
    console.log(e)
  })